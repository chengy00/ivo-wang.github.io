---
title: awk 简介
layout: post
categories:
  - 未分类
---
原文地址：http://coolshell.cn/articles/9070.html 老王在这感谢作者，写的很不错

#### 起步上台

我从netstat命令中提取了如下信息作为用例：

<div>
  <div id="highlighter_326734" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Proto Recv-Q Send-Q Local-Address          Foreign-Address             State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT</code>
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK</code>
            </div>
            
            <div class="line number18 index17 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED</code>
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">tcp        0      0 :::22                  :::*                        LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

下面是最简单最常用的awk示例，其输出第1列和第4例，

  * 其中单引号中的被大括号括着的就是awk的语句，注意，其只能被单引号包含。
  * 其中的$1..$n表示第几例。注：$0表示整个行。

<div>
  <div id="highlighter_56770" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'{print $1, $4}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Proto Local-Address</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp 0.0.0.0:3306</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp 0.0.0.0:80</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp 127.0.0.1:9000</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number18 index17 alt1">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash plain">tcp coolshell.cn:80</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">tcp :::22</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

我们再来看看awk的格式化输出，和C语言的printf没什么两样：

<div>
  <div id="highlighter_521299" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'{printf "%-8s %-8s %-8s %-18s %-22s %-15s\n",$1,$2,$3,$4,$5,$6}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Proto    Recv-Q   Send-Q   Local-Address      Foreign-Address        State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp      0        0        0.0.0.0:3306       0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp      0        0        0.0.0.0:80         0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp      0        0        127.0.0.1:9000     0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    124.205.5.146:18245    TIME_WAIT</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    61.140.101.185:37538   FIN_WAIT2</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    110.194.134.189:1032   ESTABLISHED</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    123.169.124.111:49809  ESTABLISHED</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    116.234.127.77:11502   FIN_WAIT2</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    123.169.124.111:49829  ESTABLISHED</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    183.60.215.36:36970    TIME_WAIT</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">tcp      0        4166     coolshell.cn:80    61.148.242.38:30901    ESTABLISHED</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">tcp      0        1        coolshell.cn:80    124.152.181.209:26825  FIN_WAIT1</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    110.194.134.189:4796   ESTABLISHED</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    183.60.212.163:51082   TIME_WAIT</code>
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash plain">tcp      0        1        coolshell.cn:80    208.115.113.92:50601   LAST_ACK</code>
            </div>
            
            <div class="line number18 index17 alt1">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    123.169.124.111:49840  ESTABLISHED</code>
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash plain">tcp      0        0        coolshell.cn:80    117.136.20.85:50025    FIN_WAIT2</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">tcp      0        0        :::22              :::*                   LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

#### 脱掉外套

##### 过滤记录

我们再来看看如何过滤记录（下面过滤条件为：第三列的值为0 && 第6列的值为LISTEN）

<div>
  <div id="highlighter_802393" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$3==0 && $6=="LISTEN" '</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306               0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:80                 0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000             0.0.0.0:*              LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp        0      0 :::22                      :::*                   LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

其中的“==”为比较运算符。其他比较运算符：!=, >, <, >=, <=

我们来看看各种过滤记录的方式：

<div>
  <div id="highlighter_116530" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">' $3&gt;0 {print $0}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Proto Recv-Q Send-Q Local-Address          Foreign-Address             State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

如果我们需要表头的话，我们可以引入内建变量NR：

<div>
  <div id="highlighter_6285" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$3==0 && $6=="LISTEN" || NR==1 '</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Proto Recv-Q Send-Q Local-Address          Foreign-Address             State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">tcp        0      0 :::22                  :::*                        LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

再加上格式化输出：

<div>
  <div id="highlighter_104725" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$3==0 && $6=="LISTEN" || NR==1 {printf "%-20s %-20s %s\n",$4,$5,$6}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Local-Address        Foreign-Address      State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">0.0.0.0:3306         0.0.0.0:*            LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">0.0.0.0:80           0.0.0.0:*            LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">127.0.0.1:9000       0.0.0.0:*            LISTEN</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">:::22                :::*                 LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

##### **内建变量**

说到了内建变量，我们可以来看看awk的一些内建变量：

<table border="0" cellspacing="1" cellpadding="4">
  <tr>
    <td bgcolor="#ffffff">
      $0
    </td>
    
    <td bgcolor="#ffffff">
      当前记录（这个变量中存放着整个行的内容）
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      $1~$n
    </td>
    
    <td bgcolor="#ffffff">
      当前记录的第n个字段，字段间由FS分隔
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      FS
    </td>
    
    <td bgcolor="#ffffff">
      输入字段分隔符 默认是空格或Tab
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      NF
    </td>
    
    <td bgcolor="#ffffff">
      当前记录中的字段个数，就是有多少列
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      NR
    </td>
    
    <td bgcolor="#ffffff">
      已经读出的记录数，就是行号，从1开始，如果有多个文件话，这个值也是不断累加中。
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      FNR
    </td>
    
    <td bgcolor="#ffffff">
      当前记录数，与NR不同的是，这个值会是各个文件自己的行号
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      RS
    </td>
    
    <td bgcolor="#ffffff">
      输入的记录分隔符， 默认为换行符
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      OFS
    </td>
    
    <td bgcolor="#ffffff">
      输出字段分隔符， 默认也是空格
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      ORS
    </td>
    
    <td bgcolor="#ffffff">
      输出的记录分隔符，默认为换行符
    </td>
  </tr>
  
  <tr>
    <td bgcolor="#ffffff">
      FILENAME
    </td>
    
    <td bgcolor="#ffffff">
      当前输入文件的名字
    </td>
  </tr>
</table>

怎么使用呢，比如：我们如果要输出行号：

<div>
  <div id="highlighter_122604" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$3==0 && $6=="ESTABLISHED" || NR==1 {printf "%02s %s %-20s %-20s %s\n",NR, FNR, $4,$5,$6}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">01 1 Local-Address        Foreign-Address      State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">07 7 coolshell.cn:80      110.194.134.189:1032 ESTABLISHED</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">08 8 coolshell.cn:80      123.169.124.111:49809 ESTABLISHED</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">10 10 coolshell.cn:80      123.169.124.111:49829 ESTABLISHED</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">14 14 coolshell.cn:80      110.194.134.189:4796 ESTABLISHED</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">17 17 coolshell.cn:80      123.169.124.111:49840 ESTABLISHED</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

##### **指定分隔符**

<div>
  <div id="highlighter_585610" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$  </code><code class="bash functions">awk</code>  <code class="bash string">'BEGIN{FS=":"} {print $1,$3,$6}'</code> <code class="bash plain">/etc/passwd</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">root 0 </code><code class="bash plain">/root</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">bin 1 </code><code class="bash plain">/bin</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">daemon 2 </code><code class="bash plain">/sbin</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">adm 3 </code><code class="bash plain">/var/adm</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">lp 4 </code><code class="bash plain">/var/spool/lpd</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash functions">sync</code> <code class="bash plain">5 </code><code class="bash plain">/sbin</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash functions">shutdown</code> <code class="bash plain">6 </code><code class="bash plain">/sbin</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">halt 7 </code><code class="bash plain">/sbin</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

上面的命令也等价于：（-F的意思就是指定分隔符）

<div>
  <div id="highlighter_434307" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code>  <code class="bash plain">-F: </code><code class="bash string">'{print $1,$3,$6}'</code> <code class="bash plain">/etc/passwd</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

注：如果你要指定多个分隔符，你可以这样来：

<div>
  <div id="highlighter_511764" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash functions">awk</code> <code class="bash plain">-F </code><code class="bash string">'[;:]'</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

再来看一个以\t作为分隔符输出的例子（下面使用了/etc/passwd文件，这个文件是以:分隔的）：

<div>
  <div id="highlighter_958772" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code>  <code class="bash plain">-F: </code><code class="bash string">'{print $1,$3,$6}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash plain">/etc/passwd</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">root    0       </code><code class="bash plain">/root</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">bin     1       </code><code class="bash plain">/bin</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">daemon  2       </code><code class="bash plain">/sbin</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">adm     3       </code><code class="bash plain">/var/adm</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">lp      4       </code><code class="bash plain">/var/spool/lpd</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash functions">sync</code>    <code class="bash plain">5       </code><code class="bash plain">/sbin</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

#### 脱掉衬衫

##### 字符串匹配

我们再来看几个字符串匹配的示例：

<div>
  <div id="highlighter_777438" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1 highlighted">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$6 ~ /FIN/ || NR==1 {print NR,$4,$5,$6}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">1       Local-Address   Foreign-Address State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2</code>
            </div>
            
            <div class="line number7 index6 alt2">
            </div>
            
            <div class="line number8 index7 alt1 highlighted">
              <code class="bash plain">$ $ </code><code class="bash functions">awk</code> <code class="bash string">'$6 ~ /WAIT/ || NR==1 {print NR,$4,$5,$6}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">1       Local-Address   Foreign-Address State</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">5       coolshell.cn:80 124.205.5.146:18245     TIME_WAIT</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">11      coolshell.cn:80 183.60.215.36:36970     TIME_WAIT</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">15      coolshell.cn:80 183.60.212.163:51082    TIME_WAIT</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash plain">18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

上面的第一个示例匹配FIN状态， 第二个示例匹配WAIT字样的状态。其实 ~ 表示模式开始。/ /中是模式。这就是一个正则表达式的匹配。

其实awk可以像grep一样的去匹配第一行，就像这样：

<div>
  <div id="highlighter_422277" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'/LISTEN/'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">tcp        0      0 :::22                   :::*                    LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

我们可以使用 “/FIN|TIME/” 来匹配 FIN 或者 TIME :

<div>
  <div id="highlighter_773153" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$6 ~ /FIN|TIME/ || NR==1 {print NR,$4,$5,$6}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">1       Local-Address   Foreign-Address State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">5       coolshell.cn:80 124.205.5.146:18245     TIME_WAIT</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">11      coolshell.cn:80 183.60.215.36:36970     TIME_WAIT</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">15      coolshell.cn:80 183.60.212.163:51082    TIME_WAIT</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

再来看看模式取反的例子：

<div>
  <div id="highlighter_967100" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'$6 !~ /WAIT/ || NR==1 {print NR,$4,$5,$6}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">1       Local-Address   Foreign-Address State</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">2       0.0.0.0:3306    0.0.0.0:*       LISTEN</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">3       0.0.0.0:80      0.0.0.0:*       LISTEN</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">4       127.0.0.1:9000  0.0.0.0:*       LISTEN</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">7       coolshell.cn:80 110.194.134.189:1032    ESTABLISHED</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">8       coolshell.cn:80 123.169.124.111:49809   ESTABLISHED</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">10      coolshell.cn:80 123.169.124.111:49829   ESTABLISHED</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">12      coolshell.cn:80 61.148.242.38:30901     ESTABLISHED</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">14      coolshell.cn:80 110.194.134.189:4796    ESTABLISHED</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">16      coolshell.cn:80 208.115.113.92:50601    LAST_ACK</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">17      coolshell.cn:80 123.169.124.111:49840   ESTABLISHED</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">19      :::22   :::*    LISTEN</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

或是：

<div>
  <div id="highlighter_787559" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash functions">awk</code> <code class="bash string">'!/WAIT/'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

**折分文件**

awk拆分文件很简单，使用重定向就好了。下面这个例子，是按第6例分隔文件，相当的简单（其中的NR!=1表示不处理表头）。

<div>
  <div id="highlighter_826457" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
          
          <div class="line number21 index20 alt2">
            21
          </div>
          
          <div class="line number22 index21 alt1">
            22
          </div>
          
          <div class="line number23 index22 alt2">
            23
          </div>
          
          <div class="line number24 index23 alt1">
            24
          </div>
          
          <div class="line number25 index24 alt2">
            25
          </div>
          
          <div class="line number26 index25 alt1">
            26
          </div>
          
          <div class="line number27 index26 alt2">
            27
          </div>
          
          <div class="line number28 index27 alt1">
            28
          </div>
          
          <div class="line number29 index28 alt2">
            29
          </div>
          
          <div class="line number30 index29 alt1">
            30
          </div>
          
          <div class="line number31 index30 alt2">
            31
          </div>
          
          <div class="line number32 index31 alt1">
            32
          </div>
          
          <div class="line number33 index32 alt2">
            33
          </div>
          
          <div class="line number34 index33 alt1">
            34
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'NR!=1{print &gt; $6}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">$ </code><code class="bash functions">ls</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">ESTABLISHED  FIN_WAIT1  FIN_WAIT2  LAST_ACK  LISTEN  </code><code class="bash functions">netstat</code><code class="bash plain">.txt  TIME_WAIT</code>
            </div>
            
            <div class="line number5 index4 alt2">
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">ESTABLISHED</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED</code>
            </div>
            
            <div class="line number13 index12 alt2">
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">FIN_WAIT1</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1</code>
            </div>
            
            <div class="line number16 index15 alt1">
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">FIN_WAIT2</code>
            </div>
            
            <div class="line number18 index17 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2</code>
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2</code>
            </div>
            
            <div class="line number21 index20 alt2">
            </div>
            
            <div class="line number22 index21 alt1">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">LAST_ACK</code>
            </div>
            
            <div class="line number23 index22 alt2">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK</code>
            </div>
            
            <div class="line number24 index23 alt1">
            </div>
            
            <div class="line number25 index24 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">LISTEN</code>
            </div>
            
            <div class="line number26 index25 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number27 index26 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number28 index27 alt1">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number29 index28 alt2">
              <code class="bash plain">tcp        0      0 :::22                  :::*                        LISTEN</code>
            </div>
            
            <div class="line number30 index29 alt1">
            </div>
            
            <div class="line number31 index30 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">TIME_WAIT</code>
            </div>
            
            <div class="line number32 index31 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT</code>
            </div>
            
            <div class="line number33 index32 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT</code>
            </div>
            
            <div class="line number34 index33 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

你也可以把指定的列输出到文件：

<div>
  <div id="highlighter_47663" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash functions">awk</code> <code class="bash string">'NR!=1{print $4,$5 &gt; $6}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

再复杂一点：（注意其中的if-else-if语句，可见awk其实是个脚本解释器）

<div>
  <div id="highlighter_414550" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1 highlighted">
            2
          </div>
          
          <div class="line number3 index2 alt2 highlighted">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
          
          <div class="line number21 index20 alt2">
            21
          </div>
          
          <div class="line number22 index21 alt1">
            22
          </div>
          
          <div class="line number23 index22 alt2">
            23
          </div>
          
          <div class="line number24 index23 alt1">
            24
          </div>
          
          <div class="line number25 index24 alt2">
            25
          </div>
          
          <div class="line number26 index25 alt1">
            26
          </div>
          
          <div class="line number27 index26 alt2">
            27
          </div>
          
          <div class="line number28 index27 alt1">
            28
          </div>
          
          <div class="line number29 index28 alt2">
            29
          </div>
          
          <div class="line number30 index29 alt1">
            30
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash plain">'NR!=1{</code><code class="bash keyword">if</code><code class="bash plain">($6 ~ </code><code class="bash plain">/TIME</code><code class="bash plain">|ESTABLISHED/) print &gt; </code><code class="bash string">"1.txt"</code><code class="bash plain">;</code>
            </div>
            
            <div class="line number2 index1 alt1 highlighted">
              <code class="bash keyword">else</code> <code class="bash keyword">if</code><code class="bash plain">($6 ~ </code><code class="bash plain">/LISTEN/</code><code class="bash plain">) print &gt; </code><code class="bash string">"2.txt"</code><code class="bash plain">;</code>
            </div>
            
            <div class="line number3 index2 alt2 highlighted">
              <code class="bash keyword">else</code> <code class="bash plain">print &gt; </code><code class="bash string">"3.txt"</code> <code class="bash plain">}' </code><code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number4 index3 alt1">
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">$ </code><code class="bash functions">ls</code> <code class="bash plain">?.txt</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">1.txt  2.txt  3.txt</code>
            </div>
            
            <div class="line number7 index6 alt2">
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">1.txt</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT</code>
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED</code>
            </div>
            
            <div class="line number18 index17 alt1">
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">2.txt</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number21 index20 alt2">
              <code class="bash plain">tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number22 index21 alt1">
              <code class="bash plain">tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN</code>
            </div>
            
            <div class="line number23 index22 alt2">
              <code class="bash plain">tcp        0      0 :::22                  :::*                        LISTEN</code>
            </div>
            
            <div class="line number24 index23 alt1">
            </div>
            
            <div class="line number25 index24 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">3.txt</code>
            </div>
            
            <div class="line number26 index25 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2</code>
            </div>
            
            <div class="line number27 index26 alt2">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2</code>
            </div>
            
            <div class="line number28 index27 alt1">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1</code>
            </div>
            
            <div class="line number29 index28 alt2">
              <code class="bash plain">tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK</code>
            </div>
            
            <div class="line number30 index29 alt1">
              <code class="bash plain">tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

##### 统计

下面的命令计算所有的C文件，CPP文件和H文件的文件大小总和。

<div>
  <div id="highlighter_88584" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ </code><code class="bash functions">ls</code> <code class="bash plain">-l  *.cpp *.c *.h | </code><code class="bash functions">awk</code> <code class="bash string">'{sum+=$5} END {print sum}'</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">2511401</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

我们再来看一个统计各个connection状态的用法：（我们可以看到一些编程的影子了，大家都是程序员我就不解释了。注意其中的数组的用法）

<div>
  <div id="highlighter_162244" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash string">'NR!=1{a[$6]++;} END {for (i in a) print i ", " a[i];}'</code> <code class="bash functions">netstat</code><code class="bash plain">.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">TIME_WAIT, 3</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">FIN_WAIT1, 1</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">ESTABLISHED, 6</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">FIN_WAIT2, 3</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">LAST_ACK, 1</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">LISTEN, 4</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

再来看看统计每个用户的进程的占了多少内存（注：sum的RSS那一列）

<div>
  <div id="highlighter_57336" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2 highlighted">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">ps</code> <code class="bash plain">aux | </code><code class="bash functions">awk</code> <code class="bash string">'NR!=1{a[$1]+=$6;} END { for(i in a) print i ", " a[i]"KB";}'</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">dbus, 540KB</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">mysql, 99928KB</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">www, 3264924KB</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">root, 63644KB</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">hchen, 6020KB</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

#### 脱掉内衣

##### awk脚本

在上面我们可以看到一个END关键字。END的意思是“处理完所有的行的标识”，即然说到了END就有必要介绍一下BEGIN，这两个关键字意味着执行前和执行后的意思，语法如下：

  * BEGIN{ 这里面放的是执行前的语句 }
  * END {这里面放的是处理完所有的行后要执行的语句 }
  * {这里面放的是处理每一行时要执行的语句}

为了说清楚这个事，我们来看看下面的示例：

假设有这么一个文件（学生成绩表）：

<div>
  <div id="highlighter_655323" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash plain">score.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">Marry   2143 78 84 77</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">Jack    2321 66 78 45</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">Tom     2122 48 77 71</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">Mike    2537 87 97 95</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">Bob     2415 40 57 62</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

我们的awk脚本如下（我没有写有命令行上是因为命令行上不易读，另外也在介绍另一种用法）：

<div>
  <div id="highlighter_421190" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
          
          <div class="line number15 index14 alt2">
            15
          </div>
          
          <div class="line number16 index15 alt1">
            16
          </div>
          
          <div class="line number17 index16 alt2">
            17
          </div>
          
          <div class="line number18 index17 alt1">
            18
          </div>
          
          <div class="line number19 index18 alt2">
            19
          </div>
          
          <div class="line number20 index19 alt1">
            20
          </div>
          
          <div class="line number21 index20 alt2">
            21
          </div>
          
          <div class="line number22 index21 alt1">
            22
          </div>
          
          <div class="line number23 index22 alt2">
            23
          </div>
          
          <div class="line number24 index23 alt1">
            24
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ </code><code class="bash functions">cat</code> <code class="bash functions">cal</code><code class="bash plain">.</code><code class="bash functions">awk</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash preprocessor bold">#!/bin/awk -f</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash comments">#运行前</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">BEGIN {</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash spaces">    </code><code class="bash plain">math = 0</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash spaces">    </code><code class="bash plain">english = 0</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash spaces">    </code><code class="bash plain">computer = 0</code>
            </div>
            
            <div class="line number8 index7 alt1">
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL\n"</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"---------------------------------------------\n"</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">}</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash comments">#运行中</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">{</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash spaces">    </code><code class="bash plain">math+=$3</code>
            </div>
            
            <div class="line number15 index14 alt2">
              <code class="bash spaces">    </code><code class="bash plain">english+=$4</code>
            </div>
            
            <div class="line number16 index15 alt1">
              <code class="bash spaces">    </code><code class="bash plain">computer+=$5</code>
            </div>
            
            <div class="line number17 index16 alt2">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"%-6s %-6s %4d %8d %8d %8d\n"</code><code class="bash plain">, $1, $2, $3,$4,$5, $3+$4+$5</code>
            </div>
            
            <div class="line number18 index17 alt1">
              <code class="bash plain">}</code>
            </div>
            
            <div class="line number19 index18 alt2">
              <code class="bash comments">#运行后</code>
            </div>
            
            <div class="line number20 index19 alt1">
              <code class="bash plain">END {</code>
            </div>
            
            <div class="line number21 index20 alt2">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"---------------------------------------------\n"</code>
            </div>
            
            <div class="line number22 index21 alt1">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"  TOTAL:%10d %8d %8d \n"</code><code class="bash plain">, math, english, computer</code>
            </div>
            
            <div class="line number23 index22 alt2">
              <code class="bash spaces">    </code><code class="bash functions">printf</code> <code class="bash string">"AVERAGE:%10.2f %8.2f %8.2f\n"</code><code class="bash plain">, math</code><code class="bash plain">/NR</code><code class="bash plain">, english</code><code class="bash plain">/NR</code><code class="bash plain">, computer</code><code class="bash plain">/NR</code>
            </div>
            
            <div class="line number24 index23 alt1">
              <code class="bash plain">}</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

我们来看一下执行结果：（也可以这样运行 ./cal.awk score.txt）

<div>
  <div id="highlighter_206318" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash plain">-f </code><code class="bash functions">cal</code><code class="bash plain">.</code><code class="bash functions">awk</code> <code class="bash plain">score.txt</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash plain">NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL</code>
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">---------------------------------------------</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">Marry  2143     78       84       77      239</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash plain">Jack   2321     66       78       45      189</code>
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">Tom    2122     48       77       71      196</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">Mike   2537     87       97       95      279</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash plain">Bob    2415     40       57       62      159</code>
            </div>
            
            <div class="line number9 index8 alt2">
              <code class="bash plain">---------------------------------------------</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash spaces">  </code><code class="bash plain">TOTAL:       319      393      350</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">AVERAGE:     63.80    78.60    70.00</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

##### 环境变量

即然说到了脚本，我们来看看怎么和环境变量交互：（使用-v参数和ENVIRON，使用ENVIRON的环境变量需要export）

<div>
  <div id="highlighter_958866" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
          
          <div class="line number9 index8 alt2 highlighted">
            9
          </div>
          
          <div class="line number10 index9 alt1">
            10
          </div>
          
          <div class="line number11 index10 alt2">
            11
          </div>
          
          <div class="line number12 index11 alt1">
            12
          </div>
          
          <div class="line number13 index12 alt2">
            13
          </div>
          
          <div class="line number14 index13 alt1">
            14
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash plain">$ x=5</code>
            </div>
            
            <div class="line number2 index1 alt1">
            </div>
            
            <div class="line number3 index2 alt2">
              <code class="bash plain">$ y=10</code>
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash plain">$ </code><code class="bash functions">export</code> <code class="bash plain">y</code>
            </div>
            
            <div class="line number5 index4 alt2">
            </div>
            
            <div class="line number6 index5 alt1">
              <code class="bash plain">$ </code><code class="bash functions">echo</code> <code class="bash plain">$x $y</code>
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash plain">5 10</code>
            </div>
            
            <div class="line number8 index7 alt1">
            </div>
            
            <div class="line number9 index8 alt2 highlighted">
              <code class="bash plain">$ </code><code class="bash functions">awk</code> <code class="bash plain">-</code><code class="bash functions">v</code> <code class="bash plain">val=$x </code><code class="bash string">'{print $1, $2, $3, $4+val, $5+ENVIRON["y"]}'</code> <code class="bash plain">OFS=</code><code class="bash string">"\t"</code> <code class="bash plain">score.txt</code>
            </div>
            
            <div class="line number10 index9 alt1">
              <code class="bash plain">Marry   2143    78      89      87</code>
            </div>
            
            <div class="line number11 index10 alt2">
              <code class="bash plain">Jack    2321    66      83      55</code>
            </div>
            
            <div class="line number12 index11 alt1">
              <code class="bash plain">Tom     2122    48      82      81</code>
            </div>
            
            <div class="line number13 index12 alt2">
              <code class="bash plain">Mike    2537    87      102     105</code>
            </div>
            
            <div class="line number14 index13 alt1">
              <code class="bash plain">Bob     2415    40      62      72</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

#### 几个花活

最后，我们再来看几个小例子：

<div>
  <div id="highlighter_344103" class="syntaxhighlighter coolshell_syntaxhighlighter bash">
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td class="gutter">
          <div class="line number1 index0 alt2">
            1
          </div>
          
          <div class="line number2 index1 alt1">
            2
          </div>
          
          <div class="line number3 index2 alt2">
            3
          </div>
          
          <div class="line number4 index3 alt1">
            4
          </div>
          
          <div class="line number5 index4 alt2">
            5
          </div>
          
          <div class="line number6 index5 alt1">
            6
          </div>
          
          <div class="line number7 index6 alt2">
            7
          </div>
          
          <div class="line number8 index7 alt1">
            8
          </div>
        </td>
        
        <td class="code">
          <div class="container">
            <div class="line number1 index0 alt2">
              <code class="bash comments">#从file文件中找出长度大于80的行</code>
            </div>
            
            <div class="line number2 index1 alt1">
              <code class="bash functions">awk</code> <code class="bash string">'length&gt;80'</code> <code class="bash functions">file</code>
            </div>
            
            <div class="line number3 index2 alt2">
            </div>
            
            <div class="line number4 index3 alt1">
              <code class="bash comments">#按连接数查看客户端IP</code>
            </div>
            
            <div class="line number5 index4 alt2">
              <code class="bash functions">netstat</code> <code class="bash plain">-ntu | </code><code class="bash functions">awk</code> <code class="bash string">'{print $5}'</code> <code class="bash plain">| </code><code class="bash functions">cut</code> <code class="bash plain">-d: -f1 | </code><code class="bash functions">sort</code> <code class="bash plain">| </code><code class="bash functions">uniq</code> <code class="bash plain">-c | </code><code class="bash functions">sort</code> <code class="bash plain">-nr</code>
            </div>
            
            <div class="line number6 index5 alt1">
            </div>
            
            <div class="line number7 index6 alt2">
              <code class="bash comments">#打印99乘法表</code>
            </div>
            
            <div class="line number8 index7 alt1">
              <code class="bash functions">seq</code> <code class="bash plain">9 | </code><code class="bash functions">sed</code> <code class="bash string">'H;g'</code> <code class="bash plain">| </code><code class="bash functions">awk</code> <code class="bash plain">-</code><code class="bash functions">v</code> <code class="bash plain">RS=</code><code class="bash string">''</code> <code class="bash string">'{for(i=1;i&lt;=NF;i++)printf("%dx%d=%d%s", i, NR, i*NR, i==NR?"\n":"\t")}'</code>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>

#### 自己撸吧

关于其中的一些知识点可以参看<a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank">gawk的手册</a>：

  * 内建变量，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din-Variables" target="_blank">http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din-Variables</a>
  * 流控方面，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Statements" target="_blank">http://www.gnu.org/software/gawk/manual/gawk.html#Statements</a>
  * 内建函数，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din" target="_blank">http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din</a>
  * 正则表达式，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Regexp" target="_blank">http://www.gnu.org/software/gawk/manual/gawk.html#Regexp</a>

（全文完）

<div>
</div>